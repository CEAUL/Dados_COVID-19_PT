
![Rendered
README](https://github.com/CEAUL/Dados_COVID-19_PT/workflows/Render%20README/badge.svg)

## Daily Portuguese COVID-19 Data

**Last updated: Mon 19 Oct 2020 (18:04:42 WEST \[+0100\])**

  - Data available from **26 Feb 2020** until **19 Oct 2020** (237
    days).

### Download User Friendly Version

  - Download the user friendly data from:
    **[covid19pt\_DSSG\_Long.csv](https://raw.githubusercontent.com/CEAUL/Dados_COVID-19_PT/master/data/covid19pt_DSSG_Long.csv)**
    or use the following direct link in your program:
      - <https://raw.githubusercontent.com/CEAUL/Dados_COVID-19_PT/master/data/covid19pt_DSSG_Long.csv>
  - **Variables**
      - `data`: Date (Portuguese spelling).
      - `origVars`: Variable name taken from source data.
      - `origType`: Orginal variable count type.
      - `other`: Other types of `origVars`.
      - `symptoms`: Recorded COVID-19 symptoms.
      - `sex`: Gender (`F` - Females, `M` - Males, `All` - Females &
        Males).
      - `ageGrp`: Age groups in years (`desconhecidos` - unknown).
      - `ageGrpLower`: Lower limit of age group (useful for sorting).
      - `ageGrpUpper`: Upper limit of age group.
      - `region`: Portuguese Regions
      - `value`: Numeric value.
      - `valueUnits`: Units for the variable `value`.

<br>

  - Download the original unprocessed data (json to CSV) from:
    **[covid19pt\_DSSG\_Orig.csv](https://raw.githubusercontent.com/CEAUL/Dados_COVID-19_PT/master/data/covid19pt_DSSG_Orig.csv)**

### Source

For more information about the data and variables see:
**<https://github.com/dssg-pt/covid19pt-data>**

The original data were downloaded from an API provide by VOST
**<https://covid19-api.vost.pt/Requests/get_entry/>**

### Summary: Last 10 (available) Days

<table class="striped">

<caption>

Change from previous day in brackets.

</caption>

<thead>

<tr>

<th style="text-align:right;">

Date

</th>

<th style="text-align:right;">

Cases 7 Day Mean

</th>

<th style="text-align:right;">

Cases

</th>

<th style="text-align:right;">

Active

</th>

<th style="text-align:right;">

Recovered

</th>

<th style="text-align:right;">

Deaths

</th>

</tr>

</thead>

<tbody>

<tr>

<td style="text-align:right;">

Sat 10 Oct 2020

</td>

<td style="text-align:right;">

1046.7

</td>

<td style="text-align:right;">

85574 (+1646)

</td>

<td style="text-align:right;">

30704 (+1002)

</td>

<td style="text-align:right;">

52803 (+639)

</td>

<td style="text-align:right;">

2067 (+5)

</td>

</tr>

<tr>

<td style="text-align:right;">

Sun 11 Oct 2020

</td>

<td style="text-align:right;">

1073.3

</td>

<td style="text-align:right;">

86664 (+1090)

</td>

<td style="text-align:right;">

31397 (+693)

</td>

<td style="text-align:right;">

53187 (+384)

</td>

<td style="text-align:right;">

2080 (+13)

</td>

</tr>

<tr>

<td style="text-align:right;">

Mon 12 Oct 2020

</td>

<td style="text-align:right;">

1146.9

</td>

<td style="text-align:right;">

87913 (+1249)

</td>

<td style="text-align:right;">

32321 (+924)

</td>

<td style="text-align:right;">

53498 (+311)

</td>

<td style="text-align:right;">

2094 (+14)

</td>

</tr>

<tr>

<td style="text-align:right;">

Tue 13 Oct 2020

</td>

<td style="text-align:right;">

1258.4

</td>

<td style="text-align:right;">

89121 (+1208)

</td>

<td style="text-align:right;">

32964 (+643)

</td>

<td style="text-align:right;">

54047 (+549)

</td>

<td style="text-align:right;">

2110 (+16)

</td>

</tr>

<tr>

<td style="text-align:right;">

Wed 14 Oct 2020

</td>

<td style="text-align:right;">

1419.6

</td>

<td style="text-align:right;">

91193 (+2072)

</td>

<td style="text-align:right;">

34583 (+1619)

</td>

<td style="text-align:right;">

54493 (+446)

</td>

<td style="text-align:right;">

2117 (+7)

</td>

</tr>

<tr>

<td style="text-align:right;">

Thu 15 Oct 2020

</td>

<td style="text-align:right;">

1537.1

</td>

<td style="text-align:right;">

93294 (+2101)

</td>

<td style="text-align:right;">

36085 (+1502)

</td>

<td style="text-align:right;">

55081 (+588)

</td>

<td style="text-align:right;">

2128 (+11)

</td>

</tr>

<tr>

<td style="text-align:right;">

Fri 16 Oct 2020

</td>

<td style="text-align:right;">

1710.6

</td>

<td style="text-align:right;">

95902 (+2608)

</td>

<td style="text-align:right;">

37687 (+1602)

</td>

<td style="text-align:right;">

56066 (+985)

</td>

<td style="text-align:right;">

2149 (+21)

</td>

</tr>

<tr>

<td style="text-align:right;">

Sat 17 Oct 2020

</td>

<td style="text-align:right;">

1783.0

</td>

<td style="text-align:right;">

98055 (+2153)

</td>

<td style="text-align:right;">

37974 (+287)

</td>

<td style="text-align:right;">

57919 (+1853)

</td>

<td style="text-align:right;">

2162 (+13)

</td>

</tr>

<tr>

<td style="text-align:right;">

Sun 18 Oct 2020

</td>

<td style="text-align:right;">

1892.4

</td>

<td style="text-align:right;">

99911 (+1856)

</td>

<td style="text-align:right;">

38730 (+756)

</td>

<td style="text-align:right;">

59000 (+1081)

</td>

<td style="text-align:right;">

2181 (+19)

</td>

</tr>

<tr>

<td style="text-align:right;">

Mon 19 Oct 2020

</td>

<td style="text-align:right;">

1992.4

</td>

<td style="text-align:right;">

101860 (+1949)

</td>

<td style="text-align:right;">

39696 (+966)

</td>

<td style="text-align:right;">

59966 (+966)

</td>

<td style="text-align:right;">

2198 (+17)

</td>

</tr>

</tbody>

</table>

<img src="README_figs/README-plotNewCases-1.png" width="672" />

## Example Usage

### Read in the data

Using the `data.table` package to process the data.

``` r
# Load Libraries
library(data.table)
library(here)

# Read in data as a data.frame and data.table object.
CVPT <- fread(here("data", "covid19pt_DSSG_Long.csv"))
# You can use the direct link:
# CV <- fread("https://raw.githubusercontent.com/CEAUL/Dados_COVID-19_PT/master/data/covid19pt_DSSG_Long.csv")

# Looking at the key variables in the original long dataset.
CVPT[, .(data, origVars, origType, sex, ageGrp, region, value, valueUnits)]
##              data   origVars   origType sex ageGrp   region value valueUnits
##     1: 2020-02-26     ativos     ativos All        Portugal    NA           
##     2: 2020-02-27     ativos     ativos All        Portugal    NA           
##     3: 2020-02-28     ativos     ativos All        Portugal    NA           
##     4: 2020-02-29     ativos     ativos All        Portugal    NA           
##     5: 2020-03-01     ativos     ativos All        Portugal    NA           
##    ---                                                                      
## 20378: 2020-10-15 vigilancia vigilancia All        Portugal 51601      Count
## 20379: 2020-10-16 vigilancia vigilancia All        Portugal 51784      Count
## 20380: 2020-10-17 vigilancia vigilancia All        Portugal 52543      Count
## 20381: 2020-10-18 vigilancia vigilancia All        Portugal 54851      Count
## 20382: 2020-10-19 vigilancia vigilancia All        Portugal 55425      Count

# Order data by original variable name and date.
setkeyv(CVPT, c("origVars", "data"))

# Convert data to a data object in dataset and add a change from previous day variable.
# Added a 7 day rolling average for origVars (except for symptoms). 
# Columns `data` is date in Portuguese.
CV <- CVPT[, data := as.Date(data, format = "%Y-%m-%d")][
  , dailyChange := value - shift(value, n=1, fill=NA, type="lag"), by = origVars][
    grepl("^sintomas", origVars), dailyChange := NA][
  , mean7Day := fifelse(origVars %chin% c("ativos", "confirmados", "obitos", "recuperados"), 
                         frollmean(dailyChange, 7), as.numeric(NA))]
```

### Overall Number of Deaths (daily)

``` r
library(ggplot2)
library(magrittr)

# Change the ggplot theme.
theme_set(theme_bw())
# Data error prevents by sex plot.
# obMF <- CV[origType=="obitos" & sex %chin% c("M", "F") & ageGrp=="" & region == "Portugal"]
obAll <- CV[origType=="obitos" & sex %chin% c("All") & ageGrp=="" & region == "Portugal"][ 
  , sex := NA]

obAll %>% 
  ggplot(aes(x=data, y=dailyChange)) +
  geom_bar(stat = "identity", fill = "grey75") +
  geom_line(data = obAll, aes(x = data, y = mean7Day), group=1, colour = "brown") +
  scale_x_date(date_breaks = "1 months",
               date_labels = "%b-%y",
               limits = c(min(cvwd$data2, na.rm = TRUE), NA)) +
  theme(legend.position = "bottom") +
  labs(
    title = "COVID-19 Portugal: Number Daily Deaths with 7 Day Rolling Mean",
    x = "",
    y = "Number of Deaths",
    colour = "",
    fill = "",
    caption = paste0("Updated on: ", format(Sys.time(), "%a %d %b %Y (%H:%M:%S %Z [%z])"))
    )
## Warning: Removed 1 rows containing missing values (position_stack).
## Warning: Removed 7 row(s) containing missing values (geom_path).
```

<img src="README_figs/README-deathsbySex-1.png" width="672" />

### Recorded Number of Confirmed COVID-19 Cases by Age Group

``` r
CV[origType=="confirmados" & !(ageGrp %chin% c("", "desconhecidos"))][
  , .(valueFM = sum(value)), .(data, ageGrp)] %>%
  ggplot(., aes(x=data, y=valueFM, colour = ageGrp)) +
  geom_line() +
  scale_x_date(date_breaks = "2 months",
               date_labels = "%b-%y",
               limits = c(min(cvwd$data2, na.rm = TRUE), NA)) +
  scale_y_continuous() +
  theme(legend.position = "bottom") +
  labs(
    title = "COVID-19 Portugal: Number of Confirmed Cases by Age Group",
    x = "",
    y = "Number of Confirmed Cases",
    caption = paste0("Updated on: ", format(Sys.time(), "%a %d %b %Y (%H:%M:%S %Z [%z])")),
    colour = "Age Group")
## Warning: Removed 54 row(s) containing missing values (geom_path).
```

<img src="README_figs/README-casesbyAgeSex-1.png" width="672" />

### Recorded Number of Confirmed COVID-19 Cases by Region

``` r
CV[origType=="confirmados" & ageGrp=="" & region!="Portugal"] %>%
  ggplot(., aes(x=data, y=value, colour=region)) +
  geom_line() +
  scale_x_date(date_breaks = "1 months",
               date_labels = "%b-%y",
               limits = c(min(cvwd$data2, na.rm = TRUE), NA)) +
  scale_y_log10() +
  theme(legend.position = "bottom") +
  labs(
    title = "COVID-19 Portugal: Number of Confirmed Cases by Region",
    x = "",
    y = "Number of Confirmed Cases",
    caption = paste0("Updated on: ", format(Sys.time(), "%a %d %b %Y (%H:%M:%S %Z [%z])")),
    colour = "Region")
## Warning: Transformation introduced infinite values in continuous y-axis
## Warning: Removed 221 row(s) containing missing values (geom_path).
```

<img src="README_figs/README-casesbyRegion-1.png" width="672" />

<hr>

## Issues & Notes

### Use and interpret with care.

The data are provided as is. Any quality issues or errors in the source
data will be reflected in the user friend data.

Please **create an issue** to discuss any errors, issues, requests or
improvements.

### Calculated change between days can be negative (`dailyChange`).

``` r
CV[dailyChange<0 & !(origType %in% c("vigilancia", "internados"))][
  , .(data, origType, origVars, value, dailyChange)]
##            data    origType              origVars value dailyChange
##   1: 2020-05-12      ativos                ativos 23737        -249
##   2: 2020-05-16      ativos                ativos 23785        -280
##   3: 2020-05-17      ativos                ativos 23182        -603
##   4: 2020-05-18      ativos                ativos 21548       -1634
##   5: 2020-05-22      ativos                ativos 21321        -862
##  ---                                                               
## 298: 2020-07-03      obitos      obitos_arscentro   248          -1
## 299: 2020-06-20      obitos              obitos_f   768          -1
## 300: 2020-10-05      obitos              obitos_f     0       -1001
## 301: 2020-10-05      obitos              obitos_m     0       -1004
## 302: 2020-05-21 transmissao transmissao_importada   767          -3
```
